************************************************************
OBJETO: Dataenvironment
************************************************************
*** PROPIEDADES ***
Top = 220
Left = 1
Width = 520
Height = 200
DataSource = .NULL.
Name = "Dataenvironment"

*** METODOS ***


************************************************************
OBJETO: FORM_PEDIDO_ONLINE
************************************************************
*** PROPIEDADES ***
DoCreate = .T.
HalfHeightCaption = .T.
MaxButton = .F.
MinButton = .F.
Dockable = 1
siscli_cnn_w32 = 
es_siscli = .F.
Name = "FORM_PEDIDO_ONLINE"
GRDPEDIDOS.COLUMN1.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN1.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN1.Name = "COLUMN1"
GRDPEDIDOS.COLUMN2.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN2.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN2.Name = "COLUMN2"
GRDPEDIDOS.COLUMN3.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN3.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN3.Name = "COLUMN3"
GRDPEDIDOS.COLUMN4.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN4.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN4.Name = "COLUMN4"
GRDPEDIDOS.COLUMN5.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN5.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN5.Name = "COLUMN5"
GRDPEDIDOS.COLUMN6.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN6.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN6.Name = "COLUMN6"
GRDPEDIDOS.COLUMN7.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN7.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN7.Name = "COLUMN7"
GRDPEDIDOS.COLUMN8.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN8.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN8.Name = "COLUMN8"
GRDPEDIDOS.COLUMN9.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN9.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN9.Name = "COLUMN9"
GRDPEDIDOS.COLUMN10.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN10.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN10.Name = "COLUMN10"
GRDPEDIDOS.COLUMN11.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN11.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN11.Name = "COLUMN11"
GRDPEDIDOS.COLUMN12.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN12.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN12.Name = "COLUMN12"
GRDPEDIDOS.COLUMN13.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN13.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN13.Name = "COLUMN13"
GRDPEDIDOS.COLUMN14.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN14.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN14.Name = "COLUMN14"
GRDPEDIDOS.COLUMN15.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN15.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN15.Name = "COLUMN15"
GRDPEDIDOS.COLUMN16.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN16.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN16.Name = "COLUMN16"
GRDPEDIDOS.COLUMN17.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN17.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN17.Name = "COLUMN17"
GRDPEDIDOS.COLUMN18.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN18.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN18.Name = "COLUMN18"
GRDPEDIDOS.COLUMN19.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN19.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN19.Name = "COLUMN19"
GRDPEDIDOS.COLUMN20.HEADER1.Name = "HEADER1"
GRDPEDIDOS.COLUMN20.TEXT1.Name = "TEXT1"
GRDPEDIDOS.COLUMN20.Name = "COLUMN20"
GRDPEDIDOS.permitir_busqueda = .F.
GRDPEDIDOS.permitir_ordenamiento = .F.
GRDPEDIDOS.Name = "GRDPEDIDOS"
btnDescargar.Name = "btnDescargar"
BTNCERRAR.Name = "BTNCERRAR"
btnRefrescar.Name = "btnRefrescar"
grdBajados.COLUMN1.Header1.Name = "Header1"
grdBajados.COLUMN1.Text1.Name = "Text1"
grdBajados.COLUMN1.Name = "COLUMN1"
grdBajados.COLUMN2.Header1.Name = "Header1"
grdBajados.COLUMN2.Text1.Name = "Text1"
grdBajados.COLUMN2.Name = "COLUMN2"
grdBajados.COLUMN3.Header1.Name = "Header1"
grdBajados.COLUMN3.Text1.Name = "Text1"
grdBajados.COLUMN3.Name = "COLUMN3"
grdBajados.COLUMN4.Header1.Name = "Header1"
grdBajados.COLUMN4.Text1.Name = "Text1"
grdBajados.COLUMN4.Name = "COLUMN4"
grdBajados.COLUMN5.Header1.Name = "Header1"
grdBajados.COLUMN5.Text1.Name = "Text1"
grdBajados.COLUMN5.Name = "COLUMN5"
grdBajados.COLUMN6.Header1.Name = "Header1"
grdBajados.COLUMN6.Text1.Name = "Text1"
grdBajados.COLUMN6.Name = "COLUMN6"
grdBajados.COLUMN7.Header1.Name = "Header1"
grdBajados.COLUMN7.Text1.Name = "Text1"
grdBajados.COLUMN7.Name = "COLUMN7"
grdBajados.COLUMN8.Header1.Name = "Header1"
grdBajados.COLUMN8.Text1.Name = "Text1"
grdBajados.COLUMN8.Name = "COLUMN8"
grdBajados.COLUMN9.Header1.Name = "Header1"
grdBajados.COLUMN9.Text1.Name = "Text1"
grdBajados.COLUMN9.Name = "COLUMN9"
grdBajados.COLUMN10.Header1.Name = "Header1"
grdBajados.COLUMN10.Text1.Name = "Text1"
grdBajados.COLUMN10.Name = "COLUMN10"
grdBajados.COLUMN11.Header1.Name = "Header1"
grdBajados.COLUMN11.Text1.Name = "Text1"
grdBajados.COLUMN11.Name = "COLUMN11"
grdBajados.COLUMN12.Header1.Name = "Header1"
grdBajados.COLUMN12.Text1.Name = "Text1"
grdBajados.COLUMN12.Name = "COLUMN12"
grdBajados.COLUMN13.Header1.Name = "Header1"
grdBajados.COLUMN13.Text1.Name = "Text1"
grdBajados.COLUMN13.Name = "COLUMN13"
grdBajados.COLUMN14.Header1.Name = "Header1"
grdBajados.COLUMN14.Text1.Name = "Text1"
grdBajados.COLUMN14.Name = "COLUMN14"
grdBajados.COLUMN15.Header1.Name = "Header1"
grdBajados.COLUMN15.Text1.Name = "Text1"
grdBajados.COLUMN15.Name = "COLUMN15"
grdBajados.COLUMN16.Header1.Name = "Header1"
grdBajados.COLUMN16.Text1.Name = "Text1"
grdBajados.COLUMN16.Name = "COLUMN16"
grdBajados.COLUMN17.Header1.Name = "Header1"
grdBajados.COLUMN17.Text1.Name = "Text1"
grdBajados.COLUMN17.Name = "COLUMN17"
grdBajados.COLUMN18.Header1.Name = "Header1"
grdBajados.COLUMN18.Text1.Name = "Text1"
grdBajados.COLUMN18.Name = "COLUMN18"
grdBajados.COLUMN19.Header1.Name = "Header1"
grdBajados.COLUMN19.Text1.Name = "Text1"
grdBajados.COLUMN19.Name = "COLUMN19"
grdBajados.COLUMN20.Header1.Name = "Header1"
grdBajados.COLUMN20.Text1.Name = "Text1"
grdBajados.COLUMN20.Name = "COLUMN20"
grdBajados.permitir_busqueda = .F.
grdBajados.permitir_ordenamiento = .F.
grdBajados.Name = "grdBajados"
CLSETIQUETA1.Name = "CLSETIQUETA1"
Clsetiqueta2.Name = "Clsetiqueta2"
btnActualizarWeb.Name = "btnActualizarWeb"

*** METODOS ***
PROCEDURE connect_tocloud_w32
LOCAL lcCadenaConexion

lcCadenaConexion = getConfig("SCWCONN_W32")
Thisform.siscli_cnn_w32 = CREATEOBJECT("odbc_connect")
Thisform.siscli_cnn_w32 .ConnectionString = lcCadenaConexion
IF !Thisform.siscli_cnn_w32.Open() THEN
	MESSAGEBOX(Thisform.siscli_cnn_w32 .ErrorMessage, 0+16, Thisform.Caption)
	RETURN .F.
ENDIF
RETURN .T.
ENDPROC
PROCEDURE disconnect_fromcloud_w32
Thisform.siscli_cnn_w32.close()
ENDPROC
PROCEDURE insert_to_pedext_w32
LOCAL loCmd, lnIdArticulo

loCmd = CREATEOBJECT("odbc_command")
lnIdArticulo = Thisform.articulo_getbyid()

loCmd.CommandText = "CALL pedext_insert ( " ;
	+ "?idPedCab, ?idCliente, ?tipoSist, ?idArticulo, ?fecEmis, " ;
	+ "?codArt, ?cantidad, ?observ)"
loCmd.AddParameter("idPedCab", ALLTRIM(STR(cur_detalle.idPedCab)), .f., .f.)
loCmd.AddParameter("idCliente", ALLTRIM(STR(cur_cabped.idCliente)), .f., .f.)
loCmd.AddParameter("tipoSist", ALLTRIM(STR(cur_cabped.tipoSist)), .f., .f.)
loCmd.AddParameter("idArticulo", ALLTRIM(STR(lnIdArticulo)), .f., .f.)
loCmd.AddParameter("fecEmis", cur_cabped.fecEmis, .f., .t.)
loCmd.AddParameter("codArt", ALLTRIM(cur_detalle.codArt), .t., .f.)
loCmd.AddParameter("cantidad", ALLTRIM(STR(cur_detalle.cantidad, 10, 2)), .f., .f.)
loCmd.AddParameter("observ", ALLTRIM(cur_cabped.observ), .t., .f.)

loCmd.ActiveConnection = goConn.ActiveConnection
IF (!loCmd.Execute()) THEN
	goConn.Rollback()
	Thisform.disconnect_from_cloud()
	RETURN .F.
ENDIF
RETURN .T.
ENDPROC
PROCEDURE articulo_getbyid
LOCAL loRes
LOCAL lcSql
LOCAL lnIdArticulo

loRes = CREATEOBJECT("odbc_result")
lcSql = "CALL articulos_getByCod(?codArt)"
lcSql = loRes.AddParameter(lcSql, "codArt", ALLTRIM(cur_detalle.codArt), .t., .f.)
loRes.ActiveConnection = goConn.ActiveConnection
loRes.Cursor_Name = "cur_x"
loRes.OpenQuery(lcSql)
lnIdArticulo = cur_x.idArticulo
loRes.Close_Query()
RETURN lnIdArticulo
ENDPROC
PROCEDURE marcar_procesado_w32
LOCAL loCmd

loCmd = CREATEOBJECT("odbc_command")
loCmd.ActiveConnection = this.siscli_cnn_w32.ActiveConnection
loCmd.CommandText = "CALL pedidos_marcarProcesado (?idPedCab)"
loCmd.AddParameter("idPedCab", ALLTRIM(STR(cur_cabped.idPedCab)), .f., .f.)
IF !loCmd.Execute() THEN
	RETURN .F.
ENDIF
RETURN .T.
ENDPROC
PROCEDURE validar_pedido
LOCAL loRes
LOCAL lcSql
LOCAL loForm

SELECT cur_cants
ZAP

loRes = CREATEOBJECT("odbc_result")

&& Me conecto a las dos bases de datos del cloud server
Thisform.connect_tocloud_w32()
Thisform.connect_to_cloud()


&& Según el tipo de catalogo recupero los items de dicho catalogo
lcSql = IIF(cur_cabped.tiposist = 1, ;
	"CALL peddet_getByCab (?idPedCab)", ;
	"CALL pedidos_getItemsByCab (?idPedCab)")

&& Si el tipo de sistema es 1 me conecto al catalogo digital web, en caso
&& contrario me conecto al SISCLI WIN 32
loRes.ActiveConnection = IIF(cur_cabped.tiposist = 1, 	;
	Thisform.siscli_connection.ActiveConnection, 		;
	Thisform.siscli_cnn_w32.ActiveConnection)

lcSql = loRes.AddParameter(lcSql, "idPedCab", ALLTRIM(STR(cur_cabped.idPedCab)), .f., .f.)
loRes.Cursor_Name = "cur_detalle"
loRes.OpenQuery(lcSql)
SELECT cur_detalle
DO WHILE !EOF("cur_detalle")
	IF !Thisform.validar_articulo(cur_detalle.codArt) THEN
		Thisform.corregir_codigo()
		loRes.Close_Query()
		
		&& Cierro la conexión de ambas bases de dattos
		Thisform.disconnect_fromcloud_w32()
		Thisform.disconnect_from_cloud()
				
		RETURN .F.
	ENDIF
	
	SELECT cur_detalle
	SKIP
ENDDO
loRes.Close_Query()

&& Cierro la conexión de ambas bases de datos
Thisform.disconnect_fromcloud_w32()
Thisform.disconnect_from_cloud()
RETURN .T.
ENDPROC
PROCEDURE corregir_codigo
LOCAL loForm

loForm = CREATEOBJECT("mg_pedidos_online_edit")
loForm.codigo_articulo_origen = cur_detalle.codArt
loForm.idpedarch = cur_cabped.idPedCab
loForm.idcliente = cur_cabped.idCliente
loForm.tipo_sistema = cur_cabped.Tiposist
if cur_cabped.Tiposist = 1 then
	loForm.iditem = cur_detalle.idPedDet
else
	loForm.iditem = cur_detalle.idItem
endif
loForm.recuperar_articulo_origen()
loForm.Show()
ENDPROC
PROCEDURE validar_articulo
PARAMETERS tcCodArt
LOCAL loRes
LOCAL lcSql
LOCAL llResult

loRes = CREATEOBJECT("odbc_result")
Thisform.Connect_tocloud_w32()
lcSql = "CALL articulos_validarCodigo (?pCodArt)"
lcSql = loRes.AddParameter(lcSql, "pCodArt", ALLTRIM(tcCodArt), .t., .f.)
loRes.ActiveConnection = goConn.ActiveConnection
loRes.Cursor_Name = "cur_x"
loRes.OpenQuery(lcSql)
SELECT cur_x
IF ALLTRIM(TYPE("cur_x.result")) == "N" THEN
	llResult = IIF(cur_x.result = 1, .t., .f.)
ELSE
	llResult = IIF(INT(VAL(cur_x.result)) = 1, .t., .f.)
ENDIF
loRes.Close_Query()
RETURN llResult

ENDPROC
PROCEDURE descargar
LOCAL loRes
LOCAL lcSql
LOCAL lnResult

loRes = CREATEOBJECT("odbc_result")

IF !Thisform.validar_pedido() THEN
	RETURN .F.
ENDIF

goConn.BeginTransaction()

Thisform.connect_to_cloud()
Thisform.connect_tocloud_w32()
SELECT cur_cabped
GO TOP
DO WHILE !EOF("cur_cabped")
	IF cur_cabped.tipoSist = 1 THEN
		lcSql = "CALL peddet_getByCab (?idPedCab)"
		loRes.ActiveConnection = Thisform.siscli_connection.ActiveConnection
	ELSE
		lcSql = "CALL pedidos_getItemsByCab (?idPedCab)"
		loRes.ActiveConnection = Thisform.siscli_cnn_w32.ActiveConnection
	ENDIF
	lcSql = loRes.AddParameter(lcSql, "idPedCab", ALLTRIM(STR(cur_cabped.idPedCab)), .f., .f.)
	loRes.Cursor_Name = "cur_detalle"
	loRes.OpenQuery(lcSql)
	
	* Valido las unidades de ventas
	SELECT cur_cants
	ZAP
	
	SELECT cur_detalle
	GO TOP
	DO WHILE !EOF("cur_detalle")
		Thisform.validar_unidad_venta(cur_detalle.codArt, cur_detalle.cantidad)
	
		SELECT cur_detalle
		SKIP
	ENDDO
	
	* Si el cursor de cantidades trae algún registro muestro formulario para
	* corregir las unidades de ventas.
	SELECT cur_cants
	IF RECCOUNT("cur_cants") <> 0 THEN
		* Corrección de cantidades.
		loForm = CREATEOBJECT("cls_pedido_online_corregir_cnt")
		loForm.show(1)
	ENDIF	
	
	SELECT cur_detalle
	GO TOP
	DO WHILE !EOF("cur_detalle")
		IF cur_cabped.tipoSist = 1 THEN
			Thisform.insert_to_pedext()
		ELSE
			Thisform.insert_to_pedext_w32()
		ENDIF
		SELECT cur_detalle
		SKIP
	ENDDO
	
	IF cur_cabped.tipoSist = 1 THEN
		IF !Thisform.marcar_procesado() THEN
			loRes.Close_Query()
			Thisform.Disconnect_from_cloud()
			RETURN .F.
		ENDIF
	ELSE
		IF !Thisform.marcar_procesado_w32() THEN
			loRes.Close_Query()
			Thisform.Disconnect_fromcloud_w32()
			RETURN .F.
		ENDIF
	ENDIF
	
	loRes.Close_Query()
	SELECT  cur_cabped
	SKIP
ENDDO
goConn.Commit()
Thisform.Disconnect_from_cloud()
Thisform.Disconnect_fromcloud_w32()
RETURN .T.
ENDPROC
PROCEDURE obtener_pedidos
LOCAL loRes
LOCAL lcSql

DODEFAULT()

loRes = CREATEOBJECT("odbc_result")
Thisform.connect_tocloud_w32()
lcSql = "CALL pedidos_getConfirmados()"
loRes.ActiveConnection = Thisform.siscli_cnn_w32.ActiveConnection
loRes.Cursor_Name = "cur_x"
loRes.OpenQuery(lcSql)
SELECT cur_cabped
APPEND FROM DBF("cur_x")
loRes.Close_Query()
Thisform.disconnect_fromcloud_w32()
SELECT cur_cabped
GO TOP
Thisform.grdPedidos.Refresh()

ENDPROC
PROCEDURE Init
DODEFAULT()

ENDPROC
PROCEDURE Load
SET TALK OFF
SET DATE FRENCH
SET CENTURY ON
SET SAFETY OFF
SET NOTIFY OFF
SET EXCLUSIVE OFF
SET DATE FRENCH
SET MULTILOCKS ON
SET DELETED ON
SET ENGINEBEHAVIOR 90

CREATE CURSOR cur_cabped ( ;
	idPedCab int,;
	idCliente int,;
	tipoSist int,;
	fecEmis D,;
	observ M null,;
	estado varchar(1),;
	procesado L,;
	razSoc varchar(60))

CREATE CURSOR cur_bajados ( ;
	idPedCab int,;
	idCliente int,;
	fecEmis D,;
	razSoc varchar(60))
	
CREATE CURSOR cur_cants ( ;
	codArt varchar(20),;
	cant_o N(20, 2),;
	unidad int,;
	cant_c N(20, 2))
	
Thisform.Dock(2)
ENDPROC
PROCEDURE insert_to_pedext
LOCAL loCmd

loCmd = CREATEOBJECT("odbc_command")
loCmd.CommandText = "CALL pedext_insert ( " ;
	+ "?idPedCab, ?idCliente, ?tipoSist, ?idArticulo, ?fecEmis, " ;
	+ "?codArt, ?cantidad, ?observ)"
loCmd.AddParameter("idPedCab", ALLTRIM(STR(cur_detalle.idPedCab)), .f., .f.)
loCmd.AddParameter("idCliente", ALLTRIM(STR(cur_cabped.idCliente)), .f., .f.)
loCmd.AddParameter("tipoSist", ALLTRIM(STR(cur_cabped.tipoSist)), .f., .f.)
loCmd.AddParameter("idArticulo", ALLTRIM(STR(cur_detalle.idArticulo)), .f., .f.)
loCmd.AddParameter("fecEmis", cur_cabped.fecEmis, .f., .t.)
loCmd.AddParameter("codArt", ALLTRIM(cur_detalle.codArt), .t., .f.)
loCmd.AddParameter("cantidad", ALLTRIM(STR(cur_detalle.cantidad, 10, 2)), .f., .f.)
loCmd.AddParameter("observ", ALLTRIM(cur_cabped.observ), .t., .f.)

loCmd.ActiveConnection = goConn.ActiveConnection
IF (!loCmd.Execute()) THEN
	goConn.Rollback()
	Thisform.disconnect_from_cloud()
	RETURN .F.
ENDIF
RETURN .T.
ENDPROC
PROCEDURE marcar_procesado
LOCAL loCmd

loCmd = CREATEOBJECT("odbc_command")
loCmd.ActiveConnection = this.siscli_connection.ActiveConnection
loCmd.CommandText = "CALL pedidoscab_recepcionar (?idPedCab)"
loCmd.AddParameter("idPedCab", ALLTRIM(STR(cur_cabped.idPedCab)), .f., .f.)
IF !loCmd.Execute() THEN
	RETURN .F.
ENDIF
RETURN .T.
ENDPROC
PROCEDURE validar_unidad_venta
**********************************************************
* Valida que la unidad de venta sea correcta.
* Fecha: 02/08/2023
**********************************************************
LPARAMETERS tcCodArt, tnCantidad

LOCAL loRes
LOCAL lcSql
LOCAL lnCantiDesp

lnCantiDesp = 0.00
loRes = CREATEOBJECT("odbc_result")

TEXT TO lcSql NOSHOW
	CALL pedonline_verificar_unidvta(?xcodart)	
ENDTEXT

lcSql = loRes.AddParameter(lcSql, "xcodart", ALLTRIM(tcCodArt), .t., .f.)
loRes.ActiveConnection = goConn.ActiveConnection
loRes.Cursor_Name = "cur_x"
loRes.OpenQuery(lcSql)

SELECT cur_x

* Verifico que si no tiene nada en codiart, que tome 1 como referencia y
* avise al usuario de que corriga la unidad de venta.
IF RECCOUNT("cur_x") = 0 THEN
	lnCantiDesp = 1
	MESSAGEBOX("El artículo " + ALLTRIM(tcCodArt) + " no tiene unidades de ventas cargada, se tomará por defecto 1 unidad.", 0+48, Thisform.Caption)
ELSE
	IF cur_x.cantiDesp = -1 THEN
		MESSAGEBOX(cur_x.mensaje, 0+48, Thisform.Caption)
		lnCantiDesp = 1
	ELSE
		lnCantiDesp = cur_x.cantiDesp
	ENDIF
ENDIF

IF (tnCantidad % lnCantiDesp) <> 0 THEN
	SELECT cur_cants
	APPEND BLANK
	REPLACE cur_cants.codArt WITH tcCodArt
	REPLACE cur_cants.cant_o WITH tnCantidad ADDITIVE
	REPLACE cur_cants.unidad WITH cur_x.cantiDesp ADDITIVE
	REPLACE cur_cants.cant_c WITH proximoMultiplo(tnCantidad, lnCantiDesp) ADDITIVE	
ENDIF

loRes.Close_Query()

SELECT cur_cants
GO TOP

ENDPROC


************************************************************
OBJETO: 
************************************************************
*** PROPIEDADES ***
Arial, 0, 8, 5, 14, 11, 29, 3, 0
Arial, 1, 8, 5, 14, 11, 29, 3, 0
Arial, 0, 9, 5, 15, 12, 32, 3, 0

*** METODOS ***


