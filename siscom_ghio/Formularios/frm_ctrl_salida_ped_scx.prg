************************************************************
OBJETO: Dataenvironment
************************************************************
*** PROPIEDADES ***
Top = 0
Left = 0
Width = 0
Height = 0
DataSource = .NULL.
Name = "Dataenvironment"

*** METODOS ***


************************************************************
OBJETO: FRM_CTRL_SALIDA_PED
************************************************************
*** PROPIEDADES ***
DoCreate = .T.
Name = "FRM_CTRL_SALIDA_PED"
contenido.btnCerrar.Name = "btnCerrar"
contenido.pgf.ErasePage = .T.
contenido.pgf.Page1.grdPedidos.COLUMN1.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN1.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN1.Name = "COLUMN1"
contenido.pgf.Page1.grdPedidos.COLUMN2.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN2.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN2.Name = "COLUMN2"
contenido.pgf.Page1.grdPedidos.COLUMN3.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN3.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN3.Name = "COLUMN3"
contenido.pgf.Page1.grdPedidos.COLUMN4.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN4.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN4.Name = "COLUMN4"
contenido.pgf.Page1.grdPedidos.COLUMN5.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN5.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN5.Name = "COLUMN5"
contenido.pgf.Page1.grdPedidos.COLUMN6.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN6.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN6.Name = "COLUMN6"
contenido.pgf.Page1.grdPedidos.COLUMN7.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN7.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN7.Name = "COLUMN7"
contenido.pgf.Page1.grdPedidos.COLUMN8.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN8.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN8.Name = "COLUMN8"
contenido.pgf.Page1.grdPedidos.COLUMN9.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN9.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN9.Name = "COLUMN9"
contenido.pgf.Page1.grdPedidos.COLUMN10.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN10.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN10.Name = "COLUMN10"
contenido.pgf.Page1.grdPedidos.COLUMN11.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN11.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN11.Name = "COLUMN11"
contenido.pgf.Page1.grdPedidos.COLUMN12.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN12.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN12.Name = "COLUMN12"
contenido.pgf.Page1.grdPedidos.COLUMN13.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN13.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN13.Name = "COLUMN13"
contenido.pgf.Page1.grdPedidos.COLUMN14.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN14.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN14.Name = "COLUMN14"
contenido.pgf.Page1.grdPedidos.COLUMN15.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN15.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN15.Name = "COLUMN15"
contenido.pgf.Page1.grdPedidos.COLUMN16.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN16.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN16.Name = "COLUMN16"
contenido.pgf.Page1.grdPedidos.COLUMN17.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN17.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN17.Name = "COLUMN17"
contenido.pgf.Page1.grdPedidos.COLUMN18.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN18.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN18.Name = "COLUMN18"
contenido.pgf.Page1.grdPedidos.COLUMN19.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN19.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN19.Name = "COLUMN19"
contenido.pgf.Page1.grdPedidos.COLUMN20.Header1.Name = "Header1"
contenido.pgf.Page1.grdPedidos.COLUMN20.Text1.Name = "Text1"
contenido.pgf.Page1.grdPedidos.COLUMN20.Name = "COLUMN20"
contenido.pgf.Page1.grdPedidos.Name = "grdPedidos"
contenido.pgf.Page1.Name = "Page1"
contenido.pgf.Page2.GRDDETALLES.COLUMN1.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN1.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN1.Name = "COLUMN1"
contenido.pgf.Page2.GRDDETALLES.COLUMN2.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN2.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN2.Name = "COLUMN2"
contenido.pgf.Page2.GRDDETALLES.COLUMN3.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN3.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN3.Name = "COLUMN3"
contenido.pgf.Page2.GRDDETALLES.COLUMN4.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN4.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN4.Name = "COLUMN4"
contenido.pgf.Page2.GRDDETALLES.COLUMN5.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN5.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN5.Name = "COLUMN5"
contenido.pgf.Page2.GRDDETALLES.COLUMN6.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN6.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN6.Name = "COLUMN6"
contenido.pgf.Page2.GRDDETALLES.COLUMN7.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN7.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN7.Name = "COLUMN7"
contenido.pgf.Page2.GRDDETALLES.COLUMN8.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN8.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN8.Name = "COLUMN8"
contenido.pgf.Page2.GRDDETALLES.COLUMN9.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN9.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN9.Name = "COLUMN9"
contenido.pgf.Page2.GRDDETALLES.COLUMN10.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN10.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN10.Name = "COLUMN10"
contenido.pgf.Page2.GRDDETALLES.COLUMN11.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN11.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN11.Name = "COLUMN11"
contenido.pgf.Page2.GRDDETALLES.COLUMN12.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN12.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN12.Name = "COLUMN12"
contenido.pgf.Page2.GRDDETALLES.COLUMN13.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN13.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN13.Name = "COLUMN13"
contenido.pgf.Page2.GRDDETALLES.COLUMN14.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN14.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN14.Name = "COLUMN14"
contenido.pgf.Page2.GRDDETALLES.COLUMN15.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN15.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN15.Name = "COLUMN15"
contenido.pgf.Page2.GRDDETALLES.COLUMN16.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN16.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN16.Name = "COLUMN16"
contenido.pgf.Page2.GRDDETALLES.COLUMN17.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN17.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN17.Name = "COLUMN17"
contenido.pgf.Page2.GRDDETALLES.COLUMN18.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN18.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN18.Name = "COLUMN18"
contenido.pgf.Page2.GRDDETALLES.COLUMN19.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN19.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN19.Name = "COLUMN19"
contenido.pgf.Page2.GRDDETALLES.COLUMN20.Header1.Name = "Header1"
contenido.pgf.Page2.GRDDETALLES.COLUMN20.Text1.Name = "Text1"
contenido.pgf.Page2.GRDDETALLES.COLUMN20.Name = "COLUMN20"
contenido.pgf.Page2.GRDDETALLES.TabIndex = 1
contenido.pgf.Page2.GRDDETALLES.Name = "GRDDETALLES"
contenido.pgf.Page2.btnGrabar.TabIndex = 3
contenido.pgf.Page2.btnGrabar.Name = "btnGrabar"
contenido.pgf.Page2.btnCancelar.TabIndex = 4
contenido.pgf.Page2.btnCancelar.Name = "btnCancelar"
contenido.pgf.Page2.CLSETIQUETA1.Name = "CLSETIQUETA1"
contenido.pgf.Page2.txtNroPedido.Name = "txtNroPedido"
contenido.pgf.Page2.Clsetiqueta2.Name = "Clsetiqueta2"
contenido.pgf.Page2.txtCliente.Name = "txtCliente"
contenido.pgf.Page2.Name = "Page2"
contenido.pgf.Name = "pgf"
contenido.Name = "contenido"

*** METODOS ***
PROCEDURE Init
LOCAL loRes, lcSql

lcSql = ""
loRes = CREATEOBJECT("odbc_result")

lcSql = "select ventascab.idVentasC, "
lcSql = lcSql + "	ventascab.fecEmision, "
lcSql = lcSql + "	clientes.idCliente, "
lcSql = lcSql + "	clientes.razSoc, "
lcSql = lcSql + "	transp.codTrans, "
lcSql = lcSql + "	transp.razSoc AS transporte, "
lcSql = lcSql + "	ventascab.cbte, "
lcSql = lcSql + "	ventascab.numCbte, "
lcSql = lcSql + "	ventascab.porDesc1, "
lcSql = lcSql + "	ventascab.porDesc2, "
lcSql = lcSql + "	ventascab.porDesc3, "
lcSql = lcSql + "	ventascab.porDesc4, "
lcSql = lcSql + "	ventascab.observ "
lcSql = lcSql + "from ventascab "
lcSql = lcSql + "	inner join clientes on clientes.idCliente = ventascab.idCliente "
lcSql = lcSql + "	inner join transp on clientes.idTransp = transp.idTransp "
lcSql = lcSql + "where ventascab.cbte = 'PED' "
lcSql = lcSql + "	and ventascab.fecBaja IS NULL "
lcSql = lcSql + "	and ventascab.procesado = 0 "
lcSql = lcSql + "	and ventascab.idVentasC not in ( "
lcSql = lcSql + "		select idVtaCO from ventasrel) "
lcSql = lcSql + "order by clientes.idCliente ASC"

loRes.ActiveConnection = goConn.ActiveConnection
loRes.Cursor_Name = "cur_x"

IF !loRes.OpenQuery(lcSql) THEN
	MESSAGEBOX(loRes.Error_Message, 0+48, Thisform.Caption)
	RETURN .F.
ENDIF

SELECT cur_x
DO WHILE !EOF("cur_x")
	SELECT cur_pedidos
	APPEND BLANK
	REPLACE cur_pedidos.idVentasC WITH cur_x.idVentasC
	REPLACE cur_pedidos.fecEmision WITH cur_x.fecEmision ADDITIVE
	REPLACE cur_pedidos.idCliente WITH cur_x.idCliente ADDITIVE
	REPLACE cur_pedidos.codTrans WITH cur_x.codTrans ADDITIVE
	REPLACE cur_pedidos.transp WITH cur_x.transporte ADDITIVE
	REPLACE cur_pedidos.razSoc WITH cur_x.razSoc ADDITIVE
	REPLACE cur_pedidos.cbte WITH cur_x.cbte ADDITIVE
	REPLACE cur_pedidos.numCbte WITH REPLICATE("0", 8 - LEN(ALLTRIM(STR(cur_x.numCbte)))) + ALLTRIM(STR(cur_x.numCbte)) ADDITIVE
	REPLACE cur_pedidos.desc1 WITH cur_x.porDesc1 ADDITIVE
	REPLACE cur_pedidos.desc2 WITH cur_x.porDesc2 ADDITIVE
	REPLACE cur_pedidos.desc3 WITH cur_x.porDesc3 ADDITIVE
	REPLACE cur_pedidos.desc4 WITH cur_x.porDesc4 ADDITIVE
	REPLACE cur_pedidos.observ WITH cur_x.observ ADDITIVE

	SELECT cur_x
	SKIP
ENDDO

loRes.Close_Query()

SELECT cur_pedidos
GO TOP

SELECT cur_pedidos
Thisform.contenido.pgf.page1.grdPedidos.alias_name = "cur_pedidos"
Thisform.contenido.pgf.page1.grdPedidos.RecordSource = "cur_pedidos"
Thisform.contenido.pgf.page1.grdPedidos.titulos_cabeceras = "Fecha,Cliente,Razón Social,Comp.,Número"
Thisform.contenido.pgf.page1.grdPedidos.list_controlsource = "fecEmision,idCliente,razSoc,cbte,numCbte"
Thisform.contenido.pgf.page1.grdPedidos.lista_ancho_cols = "100,100,300,100,100"
Thisform.contenido.pgf.page1.grdPedidos.generar_grid()

&& Configuro la grilla que contiene el detalle
SELECT cur_detalle
Thisform.Contenido.pgf.page2.grdDetalles.alias_name = "cur_detalle"
Thisform.Contenido.pgf.page2.grdDetalles.RecordSource = "cur_detalle"
Thisform.Contenido.pgf.page2.grdDetalles.titulos_cabeceras = "Código,Descripción,Cantidad,Prioridad 1,Prioridad 2,Prioridad 3"
Thisform.Contenido.pgf.page2.grdDetalles.list_controlsource = "codArt,descripcio,cantidad,cant_pri1,cant_pri2,cant_pri3"
Thisform.Contenido.pgf.page2.grdDetalles.lista_ancho_cols = "100,300,100,100,100,100"
Thisform.Contenido.pgf.page2.grdDetalles.generar_grid()

Thisform.Contenido.pgf.page2.grdDetalles.Columns[4].ReadOnly = .F.
Thisform.Contenido.pgf.page2.grdDetalles.Columns[5].ReadOnly = .F.
Thisform.Contenido.pgf.page2.grdDetalles.Columns[6].ReadOnly = .F.

Thisform.Contenido.pgf.page1.grdPedidos.SetFocus()

RETURN .T.
ENDPROC
PROCEDURE grabar
LOCAL loCommand, lcSql

loCommand = CREATEOBJECT("odbc_command")
lcSql = ""

goConn.BeginTransaction()

SELECT cur_detalle
GO TOP

DO WHILE !EOF("cur_detalle")
	lcSql = "update ventasdet "
	lcSql = lcSql + "set cant_pri1 = " + ALLTRIM(STR(cur_detalle.cant_pri1, 10, 2)) + ", "
	lcSql = lcSql + "	cant_pri2 = " + ALLTRIM(STR(cur_detalle.cant_pri2, 10, 2)) + ", "
	lcSql = lcSql + "	cant_pri3 = " + ALLTRIM(STR(cur_detalle.cant_pri3, 10, 2)) + " "
	lcSql = lcSql + "where idVentasD = " + ALLTRIM(STR(cur_detalle.idVentasD)) + " "
	lcSql = lcSql + "	and idVentasC = " + ALLTRIM(STR(cur_detalle.idVentasC))
	
	loCommand.ActiveConnection = goConn.ActiveConnection
	loCommand.CommandText = lcSql
	
	IF !loCommand.Execute() THEN
		goConn.Rollback()
		MESSAGEBOX(loCommand.ErrorMessage, 0+48, Thisform.Caption)
		RETURN .F.
	ENDIF
	
	lcSql = "update ventascab set "
	lcSql = lcSql + "usuModi = '" + ALLTRIM(gcCodUsu) + "', "
	lcSql = lcSql + "fecModi = current_timestamp, "
	lcSql = lcSql + "idHostModi = '" + ALLTRIM(SYS(0)) + "' "
	lcSql = lcSql + "where ventascab.idVentasC = " + ALLTRIM(STR(cur_detalle.idVentasC))
	
	loCommand.ActiveConnection = goConn.ActiveConnection
	loCommand.CommandText = lcSql
	
	IF !loCommand.Execute() THEN
		goConn.Rollback()
		MESSAGEBOX(loCommand.ErrorMessage, 0+48, Thisform.Caption)
		RETURN .F.
	ENDIF

	SELECT cur_detalle
	SKIP
ENDDO

goConn.Commit()

SELECT cur_detalle
ZAP
Thisform.Contenido.pgf.page1.SetFocus()
Thisform.Contenido.pgf.page1.grdPedidos.SetFocus()
RETURN .T.
ENDPROC
PROCEDURE Load
SET TALK OFF
SET DATE FRENCH
SET CENTURY ON
SET SAFETY OFF
SET NOTIFY OFF
SET EXCLUSIVE OFF
SET DATE FRENCH
SET MULTILOCKS ON
SET DELETED ON
SET ENGINEBEHAVIOR 90

CREATE CURSOR cur_pedidos ( ;
	idVentasC	int,;
	fecEmision	datetime,;
	idCliente	int,;
	razSoc		varchar(60),;
	codTrans	int null,;
	transp		varchar(60) null,;
	cbte		varchar(4),;
	numCbte		varchar(8),;
	desc1		float(10, 2),;
	desc2		float(10, 2),;
	desc3		float(10, 2),;
	desc4		float(10, 2),;
	observ		M NULL)
	
SELECT cur_pedidos
INDEX ON idVentasC TAG idVentasC ASCENDING
INDEX ON cbte TAG cbte ASCENDING
INDEX ON numCbte TAG numCbte ASCENDING
INDEX ON fecEmision TAG fecEmision ASCENDING
INDEX ON idCliente TAG idCliente ASCENDING
INDEX ON razSoc TAG razSoc ASCENDING

CREATE CURSOR cur_detalle (	;
	idVentasC	int,;
	idVentasD	int,;
	codArt		varchar(20),;
	descripcio	varchar(100),;
	cantidad	float(10, 2),;
	cant_pri1	float(10, 2),;
	cant_pri2	float(10, 2),;
	cant_pri3	float(10, 2),;
	cant_falt	float(10, 2),;
	prArtic		float(10, 2),;
	prVenta		float(10, 2),;
	totNeto		float(10, 2))

ENDPROC
PROCEDURE abrir_pedido
LOCAL loRes, lcSql

loRes = CREATEOBJECT("odbc_result")
lcSql = ""

lcSql = "SELECT ventasdet.idVentasC, ventasdet.idVentasD, "
lcSql = lcSql + "articulos.codArt, articulos.descripcio, ventasdet.cantidad, "
lcSql = lcSql + "ventasdet.cant_pri1, ventasdet.cant_pri2, ventasdet.cant_pri3, "
lcSql = lcSql + "ventasdet.prArtic, prVenta, totNeto "
lcSql = lcSql + "FROM ventasdet "
lcSql = lcSql + "	INNER JOIN articulos ON articulos.idArticulo = ventasdet.idArticulo "
lcSql = lcSql + "WHERE ventasdet.idVentasC = " + ALLTRIM(STR(cur_pedidos.idVentasC)) + " "

SELECT cur_detalle
ZAP

loRes.ActiveConnection = goConn.ActiveConnection
loRes.Cursor_Name = "cur_x"

IF !loRes.OpenQuery(lcSql) THEN
	MESSAGEBOX(loRes.Error_Message, 0+48, Thisform.Caption)
	RETURN .F.
ENDIF

SELECT cur_x
GO TOP
DO WHILE !EOF("cur_x")
	SELECT cur_detalle
	APPEND BLANK
	REPLACE cur_detalle.idVentasC WITH cur_x.idVentasC
	REPLACE cur_detalle.idVentasD WITH cur_x.idVentasD ADDITIVE
	REPLACE cur_detalle.codArt WITH cur_x.codArt ADDITIVE
	REPLACE cur_detalle.descripcio WITH cur_x.descripcio ADDITIVE
	REPLACE cur_detalle.cantidad WITH cur_x.cantidad ADDITIVE
	REPLACE cur_detalle.cant_pri1 WITH IIF(ISNULL(cur_x.cant_pri1), 0, cur_x.cant_pri1) ADDITIVE
	REPLACE cur_detalle.cant_pri2 WITH IIF(ISNULL(cur_x.cant_pri2), 0, cur_x.cant_pri2) ADDITIVE
	REPLACE cur_detalle.cant_pri3 WITH IIF(ISNULL(cur_x.cant_pri3), 0, cur_x.cant_pri3) ADDITIVE
	REPLACE cur_detalle.prArtic WITH cur_x.prArtic ADDITIVE
	REPLACE cur_detalle.prVenta WITH cur_x.prVenta ADDITIVE
	REPLACE cur_detalle.totNeto WITH cur_x.totNeto ADDITIVE

	SELECT cur_x
	SKIP
ENDDO

loRes.Close_Query()

SELECT cur_detalle
GO TOP

Thisform.Contenido.pgf.page2.grdDetalles.Refresh()
Thisform.Contenido.pgf.page2.SetFocus()
Thisform.Contenido.pgf.page2.grdDetalles.SetFocus()
ENDPROC
PROCEDURE contenido.pgf.Page2.GRDDETALLES.COLUMN4.Text1.Valid
LOCAL lnCant

IF this.Value < 0 THEN
	MESSAGEBOX("No se puede ingresar valores negativos", 0+48, Thisform.Caption)
	RETURN .F.
ENDIF

lnCant = cur_detalle.cantidad - This.Value
SELECT cur_detalle
LOCK()
REPLACE cur_detalle.cant_pri2 WITH lnCant
UNLOCK

This.Parent.Parent.Refresh()

IF lnCant < 0 THEN
	MESSAGEBOX("La cantidad ingresada no es correcta, prioridad_1 + prioridad_2 debe ser igual a cantidad", 0+48, Thisform.Caption)
	RETURN .F.
ENDIF

ENDPROC
PROCEDURE contenido.pgf.Page2.GRDDETALLES.COLUMN5.Text1.Valid
LOCAL lnCant

IF This.Value <> 0 THEN
	IF cur_detalle.cant_pri3 > 0 THEN
		MESSAGEBOX("Atención, tiene cantidad asignada en prioridad 2, se pasará esta cantidad a prioridad 3", 0+64, Thisform.Caption)
		This.Value = cur_detalle.cant_pri3
		
		SELECT cur_detalle
		LOCK()
		REPLACE cur_detalle.cant_pri3 WITH 0
		UNLOCK
	ENDIF

	lnCant = cur_detalle.cantidad - This.Value
	SELECT cur_detalle
	LOCK()
	REPLACE cur_detalle.cant_pri1 WITH lnCant
	UNLOCK

	This.Parent.Parent.Refresh()

	IF (This.Value + cur_detalle.cant_pri1) > cur_detalle.cantidad THEN
		MESSAGEBOX("La cantidad ingresada no es correcta, prioridad_1 + prioridad_3 debe ser igual a cantidad", 0+48, Thisform.Caption)
		RETURN .F.
	ENDIF
ENDIF

RETURN .T.
ENDPROC
PROCEDURE contenido.pgf.Page2.GRDDETALLES.COLUMN6.Text1.Valid
LOCAL lnCant

IF This.Value <> 0 THEN
	IF cur_detalle.cant_pri2 > 0 THEN
		MESSAGEBOX("Atención, tiene cantidad asignada en prioridad 2, se pasará esta cantidad a prioridad 3", 0+64, Thisform.Caption)
		This.Value = cur_detalle.cant_pri2
		
		SELECT cur_detalle
		LOCK()
		REPLACE cur_detalle.cant_pri2 WITH 0
		UNLOCK
	ENDIF

	lnCant = cur_detalle.cantidad - This.Value
	SELECT cur_detalle
	LOCK()
	REPLACE cur_detalle.cant_pri1 WITH lnCant
	UNLOCK

	This.Parent.Parent.Refresh()

	IF (This.Value + cur_detalle.cant_pri1) > cur_detalle.cantidad THEN
		MESSAGEBOX("La cantidad ingresada no es correcta, prioridad_1 + prioridad_3 debe ser igual a cantidad", 0+48, Thisform.Caption)
		RETURN .F.
	ENDIF
ENDIF

RETURN .T.
ENDPROC


************************************************************
OBJETO: btnImprimir
************************************************************
*** PROPIEDADES ***
Top = 441
Left = 790
TabIndex = 2
Name = "btnImprimir"

*** METODOS ***
PROCEDURE Click
LOCAL m.codcli
LOCAL m.razsoc
LOCAL m.codtrn
LOCAL m.transporte
LOCAL m.desc1
LOCAL m.desc2
LOCAL m.desc3
LOCAL m.desc4
LOCAL m.observ
LOCAL m.nroped

m.codcli = cur_pedidos.idCliente
m.razsoc = cur_pedidos.razSoc
m.codtrans = cur_pedidos.codTrans
m.transporte = cur_pedidos.transp
m.desc1 = cur_pedidos.desc1
m.desc2 = cur_pedidos.desc2
m.desc3 = cur_pedidos.desc3
m.desc4 = cur_pedidos.desc4
m.observ = cur_pedidos.observ
m.nroped = ALLTRIM(cur_pedidos.numCbte)

SELECT cur_detalle
GO TOP
REPORT FORM "rep_hojactrl_ped" TO PRINTER PROMPT NODIALOG PREVIEW



ENDPROC


************************************************************
OBJETO: 
************************************************************
*** PROPIEDADES ***
Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 1, 8, 5, 14, 11, 29, 3, 0

*** METODOS ***


