************************************************************
OBJETO: Dataenvironment
************************************************************
*** PROPIEDADES ***
Top = 0
Left = 0
Width = 0
Height = 0
DataSource = .NULL.
Name = "Dataenvironment"

*** METODOS ***


************************************************************
OBJETO: FRM_PTO_C2
************************************************************
*** PROPIEDADES ***
BorderStyle = 2
Height = 571
Width = 989
DoCreate = .T.
Caption = "Confección de Presupuestos"
cbte = PTO
Name = "FRM_PTO_C2"
contenido.Clsetiqueta1.ForeColor = 234,238,238
contenido.Clsetiqueta1.BackColor = 243,243,243
contenido.Clsetiqueta1.Name = "Clsetiqueta1"
contenido.sel_Cliente.txtCodigo.Name = "txtCodigo"
contenido.sel_Cliente.txtDescripcion.Name = "txtDescripcion"
contenido.sel_Cliente.Name = "sel_Cliente"
contenido.Clsetiqueta2.ForeColor = 234,238,238
contenido.Clsetiqueta2.BackColor = 243,243,243
contenido.Clsetiqueta2.Name = "Clsetiqueta2"
contenido.Clsetiqueta3.ForeColor = 234,238,238
contenido.Clsetiqueta3.BackColor = 243,243,243
contenido.Clsetiqueta3.Name = "Clsetiqueta3"
contenido.txtSitIVA.Name = "txtSitIVA"
contenido.sel_FormaPago.txtCodigo.Name = "txtCodigo"
contenido.sel_FormaPago.txtDescripcion.Name = "txtDescripcion"
contenido.sel_FormaPago.Name = "sel_FormaPago"
contenido.Clslinea1.Name = "Clslinea1"
contenido.Clsetiqueta4.ForeColor = 234,238,238
contenido.Clsetiqueta4.Name = "Clsetiqueta4"
contenido.sel_Articulo.txtCodigo.Name = "txtCodigo"
contenido.sel_Articulo.txtDescripcion.Name = "txtDescripcion"
contenido.sel_Articulo.Name = "sel_Articulo"
contenido.Clsetiqueta5.ForeColor = 234,238,238
contenido.Clsetiqueta5.Name = "Clsetiqueta5"
contenido.txtCantidad.Name = "txtCantidad"
contenido.btnAgregar.Top = 188
contenido.btnAgregar.Left = 896
contenido.btnAgregar.Height = 41
contenido.btnAgregar.Width = 45
contenido.btnAgregar.Picture = ..\..\clases\imagen\iconos bajados\aceptar-comprobar-si-puede-icono-9389.ico
contenido.btnAgregar.Name = "btnAgregar"
contenido.grdDetalles.COLUMN1.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN1.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN1.Name = "COLUMN1"
contenido.grdDetalles.COLUMN2.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN2.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN2.Name = "COLUMN2"
contenido.grdDetalles.COLUMN3.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN3.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN3.Name = "COLUMN3"
contenido.grdDetalles.COLUMN4.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN4.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN4.Name = "COLUMN4"
contenido.grdDetalles.COLUMN5.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN5.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN5.Name = "COLUMN5"
contenido.grdDetalles.COLUMN6.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN6.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN6.Name = "COLUMN6"
contenido.grdDetalles.COLUMN7.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN7.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN7.Name = "COLUMN7"
contenido.grdDetalles.COLUMN8.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN8.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN8.Name = "COLUMN8"
contenido.grdDetalles.COLUMN9.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN9.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN9.Name = "COLUMN9"
contenido.grdDetalles.COLUMN10.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN10.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN10.Name = "COLUMN10"
contenido.grdDetalles.COLUMN11.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN11.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN11.Name = "COLUMN11"
contenido.grdDetalles.COLUMN12.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN12.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN12.Name = "COLUMN12"
contenido.grdDetalles.COLUMN13.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN13.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN13.Name = "COLUMN13"
contenido.grdDetalles.COLUMN14.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN14.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN14.Name = "COLUMN14"
contenido.grdDetalles.COLUMN15.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN15.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN15.Name = "COLUMN15"
contenido.grdDetalles.COLUMN16.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN16.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN16.Name = "COLUMN16"
contenido.grdDetalles.COLUMN17.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN17.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN17.Name = "COLUMN17"
contenido.grdDetalles.COLUMN18.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN18.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN18.Name = "COLUMN18"
contenido.grdDetalles.COLUMN19.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN19.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN19.Name = "COLUMN19"
contenido.grdDetalles.COLUMN20.Header1.Name = "Header1"
contenido.grdDetalles.COLUMN20.Text1.Name = "Text1"
contenido.grdDetalles.COLUMN20.Name = "COLUMN20"
contenido.grdDetalles.Name = "grdDetalles"
contenido.btnGrabar.Top = 522
contenido.btnGrabar.Left = 896
contenido.btnGrabar.Height = 44
contenido.btnGrabar.Picture = ..\..\clases\imagen\iconos bajados\disquetes-excepto-icono-7120-32.png
contenido.btnGrabar.Name = "btnGrabar"
contenido.btnCancelar.Top = 522
contenido.btnCancelar.Left = 7
contenido.btnCancelar.Height = 44
contenido.btnCancelar.Picture = ..\..\clases\imagen\iconos bajados\deshacer-icono-5403.ico
contenido.btnCancelar.Name = "btnCancelar"
contenido.Clscerrar1.Top = 522
contenido.Clscerrar1.Left = 943
contenido.Clscerrar1.Height = 44
contenido.Clscerrar1.Picture = ..\..\clases\imagen\iconos bajados\salir-de-mi-perfil-icono-3964.ico
contenido.Clscerrar1.Name = "Clscerrar1"
contenido.Clsetiqueta10.ForeColor = 234,238,238
contenido.Clsetiqueta10.Name = "Clsetiqueta10"
contenido.txtPrMay.Name = "txtPrMay"
contenido.Clsetiqueta11.ForeColor = 234,238,238
contenido.Clsetiqueta11.Name = "Clsetiqueta11"
contenido.txtPrMinorista.Name = "txtPrMinorista"
contenido.Clsetiqueta12.ForeColor = 234,238,238
contenido.Clsetiqueta12.Name = "Clsetiqueta12"
contenido.txtAlicIVA.Name = "txtAlicIVA"
contenido.btnEliminar.Top = 188
contenido.btnEliminar.Left = 942
contenido.btnEliminar.Height = 41
contenido.btnEliminar.Width = 45
contenido.btnEliminar.Picture = ..\..\clases\imagen\iconos bajados\eliminar-cancelar-icono-4935 (1).ico
contenido.btnEliminar.Name = "btnEliminar"
contenido.chkImprimeDup.Alignment = 0
contenido.chkImprimeDup.ForeColor = 234,238,238
contenido.chkImprimeDup.Name = "chkImprimeDup"
contenido.btnCbteOrigen.Caption = "\<Leer pedido"
contenido.btnCbteOrigen.Visible = .T.
contenido.btnCbteOrigen.Name = "btnCbteOrigen"
contenido.txtObserv.Name = "txtObserv"
contenido.Clsetiqueta6.ForeColor = 234,238,238
contenido.Clsetiqueta6.Name = "Clsetiqueta6"
contenido.Clsetiqueta7.ForeColor = 234,238,238
contenido.Clsetiqueta7.Name = "Clsetiqueta7"
contenido.Clsetiqueta8.ForeColor = 234,238,238
contenido.Clsetiqueta8.Name = "Clsetiqueta8"
contenido.Clsetiqueta9.ForeColor = 234,238,238
contenido.Clsetiqueta9.Name = "Clsetiqueta9"
contenido.txtTotNeto.Name = "txtTotNeto"
contenido.txtPorIVA21.Name = "txtPorIVA21"
contenido.txtPorIVA105.Name = "txtPorIVA105"
contenido.txtImpIVA21.Name = "txtImpIVA21"
contenido.txtImpIVA105.Name = "txtImpIVA105"
contenido.txtTotal.Name = "txtTotal"
contenido.Clsetiqueta14.ForeColor = 234,238,238
contenido.Clsetiqueta14.BackColor = 243,243,243
contenido.Clsetiqueta14.Name = "Clsetiqueta14"
contenido.txtDesc1.Name = "txtDesc1"
contenido.txtDesc2.Enabled = .F.
contenido.txtDesc2.Name = "txtDesc2"
contenido.txtDesc3.Enabled = .F.
contenido.txtDesc3.Name = "txtDesc3"
contenido.txtDesc4.Enabled = .F.
contenido.txtDesc4.Name = "txtDesc4"
contenido.txtImpDesc1.Name = "txtImpDesc1"
contenido.txtImpDesc2.Name = "txtImpDesc2"
contenido.txtImpDesc3.Name = "txtImpDesc3"
contenido.txtImpDesc4.Name = "txtImpDesc4"
contenido.Clsetiqueta15.ForeColor = 234,238,238
contenido.Clsetiqueta15.Name = "Clsetiqueta15"
contenido.Clsetiqueta16.Name = "Clsetiqueta16"
contenido.Clsetiqueta17.ForeColor = 234,238,238
contenido.Clsetiqueta17.Name = "Clsetiqueta17"
contenido.txtTotFact.Name = "txtTotFact"
contenido.Clsetiqueta18.ForeColor = 234,238,238
contenido.Clsetiqueta18.Name = "Clsetiqueta18"
contenido.txtPorIIBB.Name = "txtPorIIBB"
contenido.txtImpIIBB.Name = "txtImpIIBB"
contenido.Clsetiqueta19.ForeColor = 234,238,238
contenido.Clsetiqueta19.Name = "Clsetiqueta19"
contenido.txtST.Name = "txtST"
contenido.Clsetiqueta20.ForeColor = 234,238,238
contenido.Clsetiqueta20.Name = "Clsetiqueta20"
contenido.txtPorDesc1.ReadOnly = .F.
contenido.txtPorDesc1.Name = "txtPorDesc1"
contenido.txtImpDescItem1.Name = "txtImpDescItem1"
contenido.txtPorDesc2.ReadOnly = .F.
contenido.txtPorDesc2.Name = "txtPorDesc2"
contenido.txtImpDescItem2.Name = "txtImpDescItem2"
contenido.txtPorDesc3.ReadOnly = .F.
contenido.txtPorDesc3.Name = "txtPorDesc3"
contenido.txtImpDescItem3.Name = "txtImpDescItem3"
contenido.txtPorDesc4.ReadOnly = .F.
contenido.txtPorDesc4.Name = "txtPorDesc4"
contenido.txtImpDescItem4.Name = "txtImpDescItem4"
contenido.Clsetiqueta21.ForeColor = 234,238,238
contenido.Clsetiqueta21.Name = "Clsetiqueta21"
contenido.txtImpIVA.Name = "txtImpIVA"
contenido.Clsetiqueta22.ForeColor = 234,238,238
contenido.Clsetiqueta22.Name = "Clsetiqueta22"
contenido.txtSTNeto.Name = "txtSTNeto"
contenido.Clsetiqueta13.Name = "Clsetiqueta13"
contenido.txtSubTotal.Name = "txtSubTotal"
contenido.Clsetiqueta23.ForeColor = 234,238,238
contenido.Clsetiqueta23.Name = "Clsetiqueta23"
contenido.txtPrNeto.Name = "txtPrNeto"
contenido.lblExistencia.ForeColor = 234,238,238
contenido.lblExistencia.Name = "lblExistencia"
contenido.txtExistencia.Name = "txtExistencia"
contenido.Clsetiqueta24.ForeColor = 234,238,238
contenido.Clsetiqueta24.BackColor = 243,243,243
contenido.Clsetiqueta24.Name = "Clsetiqueta24"
contenido.txtPorRec.Name = "txtPorRec"
contenido.txtImpRec.Name = "txtImpRec"
contenido.txtRecItem.Name = "txtRecItem"
contenido.Clsetiqueta25.ForeColor = 234,238,238
contenido.Clsetiqueta25.BackColor = 243,243,243
contenido.Clsetiqueta25.Name = "Clsetiqueta25"
contenido.txtTelefono.Name = "txtTelefono"
contenido.Clsetiqueta26.ForeColor = 234,238,238
contenido.Clsetiqueta26.BackColor = 243,243,243
contenido.Clsetiqueta26.Name = "Clsetiqueta26"
contenido.txtcuit.Name = "txtcuit"
contenido.Clsetiqueta27.ForeColor = 234,238,238
contenido.Clsetiqueta27.Name = "Clsetiqueta27"
contenido.cboUnidVta.Name = "cboUnidVta"
contenido.txtCantPack.Name = "txtCantPack"
contenido.CLSETIQUETA28.ForeColor = 234,238,238
contenido.CLSETIQUETA28.BackColor = 243,243,243
contenido.CLSETIQUETA28.Name = "CLSETIQUETA28"
contenido.TXTOC.Name = "TXTOC"
contenido.CLSETIQUETA29.ForeColor = 234,238,238
contenido.CLSETIQUETA29.Name = "CLSETIQUETA29"
contenido.TXTPORRECITEM.Name = "TXTPORRECITEM"
contenido.Clsetiqueta30.ForeColor = 255,255,255
contenido.Clsetiqueta30.Name = "Clsetiqueta30"
contenido.txtFecEmis.Name = "txtFecEmis"
contenido.Clsetiqueta31.Name = "Clsetiqueta31"
contenido.txtMailFC.Name = "txtMailFC"
contenido.chkEnviarMail.Top = 86
contenido.chkEnviarMail.Left = 620
contenido.chkEnviarMail.Height = 18
contenido.chkEnviarMail.Width = 207
contenido.chkEnviarMail.Alignment = 0
contenido.chkEnviarMail.Name = "chkEnviarMail"
contenido.lblPrecioUnitFinal.Name = "lblPrecioUnitFinal"
contenido.txtPrUnitFinal.Name = "txtPrUnitFinal"
contenido.chkImprimirCbte.Alignment = 0
contenido.chkImprimirCbte.Visible = .T.
contenido.chkImprimirCbte.Name = "chkImprimirCbte"
contenido.btnAgregarCliente.Name = "btnAgregarCliente"
contenido.Clsetiqueta32.Name = "Clsetiqueta32"
contenido.txt_subtotal_no_grav.Name = "txt_subtotal_no_grav"
contenido.Clsetiqueta33.Name = "Clsetiqueta33"
contenido.txt_total_no_grav.Name = "txt_total_no_grav"
contenido.BackColor = 0,0,0
contenido.Name = "contenido"
mov_stock.Name = "mov_stock"
faltantes.Name = "faltantes"

*** METODOS ***
PROCEDURE realizar_cobranza
DO FORM "frmrecibos"

_screen.ActiveForm.conexion_c2 = .T.
_screen.ActiveForm.Activate()
_screen.ActiveForm.idventasc = ""
_screen.ActiveForm.idCliente = This.contenido.sel_Cliente.valcpoid

SELECT cur_faccob

GO TOP
DO WHILE !EOF("cur_faccob")
	_screen.ActiveForm.idventasc = _screen.ActiveForm.idventasc + ALLTRIM(STR(cur_faccob.idventac)) + ","

	SELECT cur_faccob
	SKIP
ENDDO

_screen.ActiveForm.abrir_fc = .t.
_screen.ActiveForm.idventasc = SUBSTR(_screen.ActiveForm.idventasc, 1, LEN(_screen.ActiveForm.idventasc) - 1)
_screen.ActiveForm.realizar_recibo_automatico()
Thisform.Release()

ENDPROC
PROCEDURE imprimir
LOCAL loRes, lcSql, m.vendedor

IF !Thisform.contenido.chkImprimirCbte.Value THEN
	RETURN .T.
ENDIF

m.vendedor = ""
lcSql = ""
loRes = CREATEOBJECT("odbc_result")

lcSql = "select * from usuarios where codUsu = '" + ALLTRIM(this.codusu) + "'"
loRes.ActiveConnection = goConn.ActiveConnection
loRes.cursor_name = "cur_x"

IF !loRes.OpenQuery(lcSql) THEN
	MESSAGEBOX(loRes.Error_Message, 0+48, Thisform.Caption)
	RETURN .F.
ENDIF

thisform.nombre_usuario = ALLTRIM(cur_x.ApelNom)

loRes.Close_Query()

DODEFAULT()

RETURN .T.
ENDPROC
PROCEDURE particionar_cbte
************************************************************************************
** Esta función permite grabar una factura cada 25 items.
** Pablo Díaz
************************************************************************************

LOCAL ln_cantitems

ln_cantitems = 0

SELECT cur_aux
ZAP 

*!*	IF !(ALLTRIM(thisform.cbte) == "COT") .AND. getGlobalCFG("STK_MODULE") THEN
*!*		IF !thisform.validar_stk_en_grabado() THEN
*!*			goConn.Rollback()
*!*			RETURN .F.
*!*		ENDIF
*!*	ENDIF

SELECT cur_detalle
IF RECCOUNT() > 0 THEN 
	GO TOP
ELSE 
	RETURN .F.
ENDIF 

************************************************************************************
** Paso de a 25 items del cursor de detalle al cursor auxiliar
************************************************************************************
SELECT cur_detalle
DO WHILE !EOF()
	ln_cantitems = ln_cantitems + 1
	
	SELECT cur_aux
	APPEND BLANK	
	
	REPLACE cur_aux.idDetalle WITH cur_detalle.idDetalle
	REPLACE cur_aux.idArticulo WITH cur_detalle.idArticulo ADDITIVE
	REPLACE cur_aux.codArt WITH cur_detalle.codArt ADDITIVE
	REPLACE cur_aux.descripcio WITH cur_detalle.descripcio ADDITIVE
	REPLACE cur_aux.nroPart WITH cur_detalle.nroPart ADDITIVE
	REPLACE cur_aux.cantidad WITH cur_detalle.cantidad ADDITIVE
	REPLACE cur_aux.prVta WITH cur_detalle.prVta ADDITIVE
	REPLACE cur_aux.pDtoVta1 WITH cur_detalle.pDtoVta1 ADDITIVE
	REPLACE cur_aux.pDtoVta2 WITH cur_detalle.pDtoVta2 ADDITIVE
	REPLACE cur_aux.pDtoVta3 WITH cur_detalle.pDtoVta3 ADDITIVE
	REPLACE cur_aux.pDtoVta4 WITH cur_detalle.pDtoVta4 ADDITIVE
	REPLACE cur_aux.iDtoVta1 WITH cur_detalle.iDtoVta1 ADDITIVE
	REPLACE cur_aux.iDtoVta2 WITH cur_detalle.iDtoVta2 ADDITIVE
	REPLACE cur_aux.iDtoVta3 WITH cur_detalle.iDtoVta3 ADDITIVE
	REPLACE cur_aux.iDtoVta4 WITH cur_detalle.iDtoVta4 ADDITIVE
	REPLACE cur_aux.pDtoCli1 WITH cur_detalle.pDtoCli1 ADDITIVE
	REPLACE cur_aux.pDtoCli2 WITH cur_detalle.pDtoCli2 ADDITIVE
	REPLACE cur_aux.pDtoCli3 WITH cur_detalle.pDtoCli3 ADDITIVE
	REPLACE cur_aux.pDtoCli4 WITH cur_detalle.pDtoCli4 ADDITIVE
	REPLACE cur_aux.iDtoCli1 WITH cur_detalle.iDtoCli1 ADDITIVE
	REPLACE cur_aux.iDtoCli2 WITH cur_detalle.iDtoCli2 ADDITIVE
	REPLACE cur_aux.iDtoCli3 WITH cur_detalle.iDtoCli3 ADDITIVE
	REPLACE cur_aux.iDtoCli4 WITH cur_detalle.iDtoCli4 ADDITIVE
	
	&& Incorporo el recargo por ítem
	REPLACE cur_aux.pRecItem WITH cur_detalle.pRecItem ADDITIVE
	REPLACE cur_aux.iRecItem WITH cur_detalle.iRecItem ADDITIVE
	
	REPLACE cur_aux.alicIVA WITH cur_detalle.alicIVA ADDITIVE
	REPLACE cur_aux.impIVA WITH cur_detalle.impIVA ADDITIVE
	REPLACE cur_aux.impNeto WITH cur_detalle.impNeto ADDITIVE
	REPLACE cur_aux.totNeto WITH cur_detalle.totNeto ADDITIVE
	REPLACE cur_aux.subTotal WITH cur_detalle.subTotal ADDITIVE
	REPLACE cur_aux.prArtic WITH cur_detalle.prArtic ADDITIVE
	REPLACE cur_aux.esOferta WITH cur_detalle.esOferta ADDITIVE
	REPLACE cur_aux.pRecVta WITH cur_detalle.pRecVta ADDITIVE 
	REPLACE cur_aux.iRecVta WITH cur_detalle.iRecVta ADDITIVE
	REPLACE cur_aux.uniDesp WITH cur_detalle.uniDesp ADDITIVE
	REPLACE cur_aux.cantPack WITH cur_detalle.cantPack ADDITIVE 
	REPLACE cur_aux.uniMed WITH cur_detalle.uniMed ADDITIVE
	
	&& Agrego los campos de no gravados
	REPLACE cur_aux.porNoGrav WITH cur_detalle.porNoGrav ADDITIVE
	REPLACE cur_aux.baseGrav WITH cur_detalle.baseGrav ADDITIVE
	REPLACE cur_aux.subtNoGrav WITH cur_detalle.subtNoGrav ADDITIVE
	
	&& Si lleva stock agrege los movimientos que hay que generar.
	IF ALLTRIM(cur_detalle.nropart) == "" THEN
		IF getGlobalCFG("STK_MODULE") THEN
			IF !(RIGHT(ALLTRIM(cur_detalle.codArt), 3) == "ARX") THEN
				Thisform.mov_stock.agregar_articulo(cur_detalle.idArticulo, ;
						cur_detalle.Cantidad, "")
			ENDIF
		ENDIF
	ELSE
		IF getGlobalCFG("STK_MODULE") THEN
			IF !(RIGHT(ALLTRIM(cur_detalle.codArt), 3) == "ARX") THEN
				Thisform.mov_stock.agregar_articulo(cur_detalle.idArticulo, ;
						cur_detalle.Cantidad, cur_detalle.nropart)
			ENDIF
		ENDIF	
	ENDIF
	
	&& Cuando el contador llegue a 25 items grabo una factura nueva.
	IF ln_cantitems = 25
		&& tengo que hacer el calculo de los totales y el grabado		
		Thisform.calc_subtot_cur_aux()
		
		IF !thisform.grabar_cbte_part()
			RETURN .F.
		ENDIF
		this.add_faccob(thisform.id_ventasc)

		&& Imprimo el comprobante
		IF !thisform.usar_fiscal
			Thisform.imprimir()
		ENDIF
		
		ln_cantitems = 0
		
		SELECT cur_aux
		ZAP
		Thisform.mov_stock.limpiar()
	ENDIF 
	
	SELECT cur_detalle
	SKIP  
ENDDO 

&& En el caso que la ultima factura no haya llegado a los 25 items
&& tengo que hacer una nueva factura con los items restantes.
IF ln_cantitems <> 0 
	&& tengo que hacer el calculo de los totales y el grabado
	Thisform.calc_subtot_cur_aux()
	
	IF !thisform.grabar_cbte_part()
		RETURN .F.
	ENDIF
	this.add_faccob(thisform.id_ventasc)
	
	&& Imprimo el comprobante
	IF !thisform.usar_fiscal
		Thisform.imprimir()
	ENDIF
	
	Thisform.mov_stock.limpiar()
ENDIF

IF getglobalcfg("PAGCTDO") .AND. This.cp_cntdias = 0 THEN
	Thisform.realizar_cobranza()
ENDIF


RETURN .T.

	
	




ENDPROC
PROCEDURE contenido.sel_Cliente.recuperar_datos
DODEFAULT()
* thisform.contenido.chkImprimir.Value = clientes.printCbte


ENDPROC
PROCEDURE contenido.btnGrabar.Click
LOCAL loFormUser
LOCAL lcCurrentUser

lcCurrentUser = gcCodUsu

loFormUser = CREATEOBJECT("cls_login_vend")
loFormUser.show(1)

IF !loFormUser.IsAccept
	loFormUser.release()
	RETURN .F.
ENDIF

thisform.codusu = gcCodUsu
DODEFAULT()
gcCodUsu = lcCurrentUser

RETURN .T.
ENDPROC


************************************************************
OBJETO: 
************************************************************
*** PROPIEDADES ***
Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 1, 8, 5, 14, 11, 29, 3, 0
Arial, 1, 9, 6, 15, 12, 32, 3, 0

*** METODOS ***


